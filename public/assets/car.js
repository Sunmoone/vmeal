function eat(e,t,n,r,i){$("#store_id_"+e).length>0?$("#food_id_"+t).length>0?add_num(e,t,r):($("#body"+e).append("<tr id='food_id_"+t+"'><td>"+n+"</td><td><span id='food_price_"+t+"'>"+r+"</span>元</td><td><a onclick='reduce("+e+","+t+","+r+");'>-</a><span id='food_num_"+t+"''>1</span><a onclick='add_food_num("+e+","+t+","+r+");'>+</a><span>&nbsp;</span><a onclick='remove_food("+e+","+t+","+r+");'>×</a>	</td></tr>"),add_price(r)):($("#order_title").after("<div id ='store_id_"+e+"' class='order_content'><input type='hidden' value='"+r+"' id='store_price_"+e+"' /><div class='res_name'><div>"+i+"</div><div title='删除已点餐品'><input id='delete' type='button' onclick = 'clear_store_food("+e+");'/></div></div><table class='foodlist' cellpadding='0px' cellspacing='0px'><thead><tr><td>菜品</td>	<td>单价</td><td>&nbsp;</td></tr></thead><tbody id='body"+e+"'><tr id='food_id_"+t+"'><td>"+n+"</td><td><span id='food_price_"+t+"'>"+r+"</span>元</td><td><a onclick='reduce("+e+","+t+","+r+");'>-</a><span id='food_num_"+t+"'>1</span><a onclick='add_food_num("+e+","+t+","+r+");'>+</a><span>&nbsp;</span><a onclick='remove_food("+e+","+t+","+r+")'>×</a></td></tr></tbody></table></div>"),add_price(r))}function clear_store_food(e){eat_post(e,"","","","",3)}function add_food_num(e,t,n){eat_post(e,"",t,"",n,0)}function reduce(e,t,n){eat_post(e,"",t,"",n,1)}function remove_food(e,t,n){eat_post(e,"",t,"",n,2)}function add_num(e,t,n){$("#food_num_"+t).text(parseFloat($("#food_num_"+t).text())+1),add_price(n),$("#store_price_"+e).attr("value",parseFloat($("#store_price_"+e).attr("value"))+parseFloat(n))}function add_price(e){$("#total_price").text(parseFloat($("#total_price").text())+parseFloat(e))}function reduce_price(e){$("#total_price").text(parseFloat($("#total_price").text())-parseFloat(e))}function eat_post(e,t,n,r,i,s){$.ajax({type:"POST",url:"/carts/action/",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},data:{store_id:e,store_name:t,food_id:n,food_name:r,price:i,type:s},dataType:"json",success:function(o){o.status=="ok"&&(s==0?(t==""?add_num(e,n,i):eat(e,n,r,i,t),$("#foot").css("display","block"),$("#empty_food").css("display","none")):s==1?parseInt($("#food_num_"+n).text())==1?remove_food(e,n):($("#food_num_"+n).text(parseFloat($("#food_num_"+n).text())-1),reduce_price(i),$("#store_price_"+e).attr("value",parseFloat($("#store_price_"+e).attr("value"))-parseFloat(i))):s==2?(reduce_price(parseInt($("#food_num_"+n).text())*parseFloat($("#food_price_"+n).text())),$("#food_id_"+n).remove(),$("#body"+e+":has(tr)").length==0&&$("#store_id_"+e).remove(),$("#store_price_"+e).attr("value",parseFloat($("#store_price_"+e).attr("value"))-parseInt($("#food_num_"+n).text())*parseFloat($("#food_price_"+n).text())),$(".order_content").size()==0&&($("#foot").css("display","none"),$("#empty_food").css("display","block"))):s==3&&(reduce_price($("#store_price_"+e).attr("value")),$("#store_id_"+e).remove(),$(".order_content").size()==0&&($("#foot").css("display","none"),$("#empty_food").css("display","block"))))}})}function post_my_cart(){if($("#total_price").text()==0)return alert(" 购物车为空，赶快去吃吧！"),!1;$("#user_loged").text()!="ok"?($("#user_redirect").val(1),dk()):window.location.replace("/users/bill")}$(document).ready(function(){$(window).scroll(function(){$(window).scrollTop()>238?($(".main_content_right_order").css({position:"fixed",display:"block"}),$(".main_content_right_order").css("margin-top","-218px")):($(".main_content_right_order").css("margin-top","18px"),$(".main_content_right_order").css("position",""))})});