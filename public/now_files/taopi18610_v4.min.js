(function(a){tuan800ued.addModule("toolbar_pi",{Init:function(){if(!tuanpub.loginQueue){tuanpub.loginQueue=new a.Buffers()}},OnLoad:function(b){var c=a("#prologin").length==0?"tblogin":"prologin";PassportSC.drawPassportNew(c,this.toolbarTpl,3002)},toolbarTpl:function(c,f,g){var b=PassportCardList[c];var d=document.location.href.indexOf("login")==-1?"?return_to="+encodeURIComponent(document.location.href):"?return_to="+encodeURIComponent("http://www.tao800.com");b.rootElement=function(){this.cElement=f;this.sElement=f.after('<div class="hidden"></div>').next()};b.drawLoginForm=function(){var e=new a.Buffers();e.push('<a href="http://www.tao800.com/login'+d+'">登录</a> <a href="http://www.tao800.com/signup'+d+'">免费注册</a> <span></span>');this.cElement.html(e.toString())};b.drawPassportWait=function(e){this.cElement.html("登录中，请稍候...")};b._drawPassportCard=function(){var e=this.cookie;var h=new a.Buffers();h.push('您好，<a href="http://www.tao800.com/profile/signal/all" class="user" target="_blank">'+b.cookieHandle().split("@")[0]+"</a>&nbsp;");h.push('<a href="javascript:PassportCardList['+c+'].doLogout();">退出</a>');this.cElement.html(h.toString());if(e.nkd==0){f.find(".user").attr("href","http://passport.tuan800.com/account/setting"+d)}};if(f.attr("id")=="prologin"){b.logoutRedirectUrl="http://www.tao800.com/"}b.loginApp=function(e){};b.logoutApp=function(){};b.drawPassport(f)}})})(jQuery);(function(a){tuan800ued.addModule("login_passport",{Init:function(){if(!tuanpub.loginQueue){tuanpub.loginQueue=new a.Buffers()}},loginTpl:function(c,f,g){var d=this;var b=PassportCardList[c];b.rootElement=function(){this.rootElement=f;this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td style="" class="ppseltit" id="ppseltitId">'+this.selectorTitle+'</td></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div>');if(this.selectorTitle==null||this.selectorTitle.length==0){this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr></tr><tr><td height="0"/></tr><tr><td /></tr></tbody></table></div>')}var e=this.rootElement.find("div");this.dsElement=e.eq(0);this.dsAnchor=this.dsElement.find("td:last");this.sElement=e.eq(1);f.parent().append('<div class="login_mid"></div>');this.cElement=f.next()};b._drawLoginForm=function(){var h="邮箱/手机号/用户名";var i=new a.Buffers();if(b.emailPostfix!=null&&b.emailPostfix.length>0){var l=b.emailPostfix[0];if(typeof(j)=="string"&&j.indexOf("@")>-1){h=l}}i.push('<div class="top hidden">用户登录</div><span>已有淘800、团800、惠800账号，可直接登录</span>');i.push('<form method="post" onsubmit="return PassportCardList['+c+'].doLogin();" name="loginform">');i.push('<label><strong>用户名：</strong><input value="'+h+'" id="ddusername" name="username" type="text" autocomplete="off" disableautocomplete="" class="t"/></label>');i.push('<label><strong>密&#12288;码：</strong><input value="" name="password" id="ddpw" type="password" class="required t" autocomplete="off" disableautocomplete="" style="display:none" /><input value="请输入密码" name="password1" id="ddpw1" type="text" class="required t" autocomplete="off" disableautocomplete="" /></label></label>');i.push('<label style="display:none;"> <strong>&nbsp;</strong><input type="checkbox" value="yes" checked="checked" name="frontend_remember_me"><span>下次自动登录</span></label>');i.push('<strong>&nbsp;</strong><input type="submit" value="" name="commit" class="b" id="login_submit"><a href="http://www.tao800.com/password_retrieve">忘记密码</a>');i.push('<label><strong>&nbsp;</strong><span class="error" id="pperrmsg"></span></label>');i.push("</form>");i.push('<div class="othlogin"><h2>您还可以通过以下方式登录</h2><p><a class="taobao" href="http://www.tao800.com/users/auth/login"></a></p></div>');this.cElement.html(i.toString());var k=a("#ddpw"),e=a("#ddpw1");k.keyup(function(m){if(m.keyCode==13){PassportCardList[" + index + "].doLogin()}});k.blur(function(){if(a(this).val()==""){k.hide();e.show()}});e.focus(function(){e.hide();k.show().focus()});a("#ddusername").unbind("blur").blur(function(){if(a(this).val()==""){a("#ddusername").val(h)}});a("#ddusername").click(function(){if(a(this).val()==h){a(this).val("").focus()}}).focus(function(){if(a(this).val()==h){a(this).val("")}})};b.drawPassportWait=function(e){var h=new a.Buffers();h.push('<div class="pptitle">团800<b>通行证</b><div class="ppthree">');h.push(this.cardTitle);h.push('</div></div><div class="ppcontent clear" id="ppcontid"><div class="ppWaitMsg">');h.push(e);h.push("</div></div>");this.cElement.html(h.toString())};b._drawPassportCard=function(){var i=new a.Buffers();i.push('<div class="pptitle2"><span>团800<b>通行证</b><div class="ppthree">'+this.cardTitle+"</div></span>");i.push('<a class="exit" href="javascript:PassportCardList['+c+'].doLogout();">退出</a>');i.push("</div>");i.push('<div class="ppcontent clear" id="ppcontid"><div class="listContA"></div><div class="middle">');i.push("<ul>");if(this.defaultApp!=""){i.push('<li class="current">'+this.defaultApp+"</li>")}for(var k=0;k<this.bottomRow[0]["length"];k++){i.push('<li><a href="'+this.bottomRow[0][k]["url"]+'" target="_blank">'+this.bottomRow[0][k]["name"]+"</a></li>");if(k!=(this.bottomRow[0].length-1)){i.push("<li>|</li>")}}for(var k=0;k<this.bottomRow[1]["length"];k++){i.push('<li><a href="'+this.bottomRow[1][k]["url"]+'" target="_blank">'+this.bottomRow[1][k]["name"]+"</a></li>");if(k!=(this.bottomRow[1].length-1)){i.push("<li>|</li>")}}i.push('<li class="profile"');var m=PassportSC.campUrl;var l=a.getStringLen(this.cookie.username);var e=this.cookie.userid.indexOf("@");var h=this.cookie.userid.substr(e+1);if(this.domainList.toString().indexOf(h)<0||l>this.cookie.userid.length){}i.push('> | <a href="http://www.tao800.com/profile/signal/all" target="_blank">个人中心</a></li></ul></div>');this.cElement.html(i.toString())};b.drawPassportInfo=function(){var e=new a.Buffers();e.push("<ul><li>"+this.cookie.userid+'<div class="candle" id="ppdefaultim"></div></li>');e.push("<li><p>欢迎您，您已经成功登录团800通行证！ </p></li><li>现在即可畅游团800所有服务。</li></ul>");this.iElement.html(e.toString());a(".diapassport .warning").html('<em class="m2"></em>您已经成功登陆团800通行证！')};b.loginApp=function(){if(a.getParm().return_to){var m=a.getParm().return_to;a.cookie("crossdomain",PassportSC.getTime(),{path:"/",expires:336});window.location.href=decodeURIComponent(m);return false}var n=tuanpub.loginQueue||{},h=n.size();for(var l=0;l<h;l++){var k=n.pop();tuanpub.loginQueue.push(k);if(a.type(k)=="function"){try{k()}catch(o){}}}a("#dialogPassport").remove()};b.logoutApp=function(){b.loginApp();a(".diapassport .warning").html('<em class="m2"></em>登录后才能完成该操作!')};b.drawPassport(f)},OnLoad:function(c){var b=this;if(a("#ppLogin").length>0){PassportSC.drawPassportNew("ppLogin",b.loginTpl,{appid:2001})}}})})(jQuery);